<html>
	<head>
		<style>
			body { margin-left: 10%; }
			canvas { width: 100%; height: 100% }
		</style>
		<link href="libs/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="libs/bootstrap-slider/bootstrap-slider.min.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<h1> Заглавие </h1>
			<div class="row">
				<div class="col-md-8">
					<div id="scene"></div>
					<label for="lifespan">Живот</label>
					<input type="range" id="lifespan" data-slider-value="0" name="lifespan" data-slider-min="0" data-slider-step="1" data-slider-max="60">
					<span>Секунди: <span id="lifespanValue"> </span> </span>

				</div>
				<div class="col-md-4">
					<input id="tempRange" type="range" data-slider-min="1000" data-slider-max="40000" data-slider-value="1000" data-slider-step="5"/>
					<br>
			    <span>Температура: <span id="tempRangeValue">1000</span>К </span>
				</div>

			</div>
		</div>

		<script src="libs/jquery-3.2.0.min.js"></script>
		<script src="libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
		<script src="libs/bootstrap-slider/bootstrap-slider.min.js"></script>
		<script src="libs/three.min.js"></script>
		<script src="scripts/TrackballControls.js"></script>
		<script src="scripts/helper.js"></script>
		<script src="scripts/slider.js"></script>

    <!-- Custom Shader Code -------------------------->
    <script id="vertexShader" type="x-shader/x-vertex">
    varying vec3 vNormal;
    void main()
    {
        vNormal = normalize( normalMatrix * normal );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
    </script>

    <!-- fragment shader a.k.a. pixel shader -->
    <script id="fragmentShader" type="x-shader/x-vertex">
    	varying vec3 vNormal;
			uniform vec3 color;

    void main()
    {
      float intensity = pow( 0.7 - dot( vNormal, vec3( 0.0, 0.0, 0.8 ) ), 2.0 );
        gl_FragColor = vec4( color, 1.0 ) * intensity;
    }
    </script>
    <!--------------------------------------------------------------->

		<script>
			var sceneView = $('#scene');
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(sceneView.width(), window.innerHeight/2 );
			sceneView.append(renderer.domElement)

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 30, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.position.set(0,0,8);
			camera.lookAt(new THREE.Vector3(0,0,0));

			//controling with the mouse
			var controls = new THREE.TrackballControls( camera,  renderer.domElement );
			controls.rotateSpeed = 1.0;
			controls.zoomSpeed = 1.2;
			controls.panSpeed = 0.8;
			controls.noZoom = false;
			controls.noPan = false;
			controls.staticMoving = true;
			controls.dynamicDampingFactor = 0.3;

			//main sphere
			var geometry = new THREE.SphereGeometry( 1, 32, 32 );
			geometry.dynamic = true;
			var texture = new THREE.ImageUtils.loadTexture( 'img8.jpg' );
			var material1 = new THREE.MeshBasicMaterial( { map: texture } );
      sphere = new THREE.Mesh( geometry, material1);
      scene.add( sphere );

			var previous = [];
			for (var i=0; i<geometry.vertices.length; i++)
			{
				previous[i] = 1;
			}

			//sample static sphere
			var geometry3 = new THREE.SphereGeometry( 1, 8, 8 );
			var material2 = new THREE.MeshPhongMaterial({color:'goldenrod', transparent: true, opacity: 0.2, wireframe: true});
			sphere2 = new THREE.Mesh( geometry3, material2);
			sphere2.position.set(3.5, 0, 0);
      scene.add( sphere2 );

			//ambient light
			scene.add( new THREE.AmbientLight('white',2) );

      // shader for the glow
      var customMaterial = new THREE.ShaderMaterial(
      {
        uniforms: { color: {type: "c", value: new THREE.Color("rgb(0, 0, 0)")}},
        vertexShader:   document.getElementById( 'vertexShader'   ).textContent,
        fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
        blending: THREE.AdditiveBlending,
				depthWrite: 	false,
				polygonOffset: true,
				polygonOffsetFactor: -10,
				polygonOffsetUnits: 100,
        transparent: true
      }   );
      var ballGeometry = new THREE.SphereGeometry( 1.1, 32, 16 );
			ballGeometry.dynamic = true;
      var ball = new THREE.Mesh( ballGeometry, customMaterial );
      scene.add( ball );

			//---------------------------------------------------
			var customMaterial2 = new THREE.ShaderMaterial(
			{
				uniforms: { color: {type: "c", value: new THREE.Color("rgb(0, 0, 0)")}},
				vertexShader:   document.getElementById( 'vertexShader'   ).textContent,
				fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
				side: THREE.BackSide,
				blending: THREE.AdditiveBlending,
				transparent: true
			}   );

			var ballGeometry2 = new THREE.SphereGeometry( 1.2, 32, 16 );
			var ball2 = new THREE.Mesh( ballGeometry2, customMaterial2 );
			scene.add( ball2 );
			//----------------------------------------------
			var previous2 = [];

			for (var i=0; i<ballGeometry.vertices.length; i++)
			{
				previous2[i] = 1;
			}

      var t = 0;
      function drawFrame()
			{
				requestAnimationFrame( drawFrame );

        if (animate) animate(t++);
				controls.update();
				renderer.render( scene, camera );
			}

			drawFrame();
      showValue(1000);
		</script>
	</body>
</html>
